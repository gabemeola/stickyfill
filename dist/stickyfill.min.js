function seppuku(){init=add=rebuild=pause=stop=kill=noop}function mergeObjects(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}function parseNumeric(t){return parseFloat(t)||0}function updateScrollPos(){scroll={top:win.pageYOffset,left:win.pageXOffset}}function onScroll(){return win.pageXOffset!=scroll.left?(updateScrollPos(),void rebuild()):void(win.pageYOffset!=scroll.top&&(updateScrollPos(),recalcAllPos()))}function onWheel(){setTimeout(function(){win.pageYOffset!=scroll.top&&(scroll.top=win.pageYOffset,recalcAllPos())},0)}function recalcAllPos(){for(var t=watchArray.length-1;t>=0;t--)recalcElementPos(watchArray[t])}function recalcElementPos(t){if(t.inited){var e=scroll.top>t.limit.start?scroll.top<t.limit.end?1:2:0;t.mode!=e&&switchElementMode(t,e)}}function fastCheck(){for(var t=watchArray.length-1;t>=0;t--)if(watchArray[t].inited){var e=Math.abs(getDocOffsetTop(watchArray[t].clone)-watchArray[t].docOffsetTop),i=Math.abs(watchArray[t].parent.node.offsetHeight-watchArray[t].parent.height);if(e>=2||i>=2)return!1}return!0}function initElement(t){isNaN(parseFloat(t.computed.top))||t.isCell||"none"==t.computed.display||(t.inited=!0,t.clone||clone(t),"absolute"!=t.parent.computed.position&&"relative"!=t.parent.computed.position&&(t.parent.node.style.position="relative"),recalcElementPos(t),t.parent.height=t.parent.node.offsetHeight,t.docOffsetTop=getDocOffsetTop(t.clone))}function deinitElement(t){var e=!0;t.clone&&killClone(t),mergeObjects(t.node.style,t.css);for(var i=watchArray.length-1;i>=0;i--)if(watchArray[i].node!==t.node&&watchArray[i].parent.node===t.parent.node){e=!1;break}e&&(t.parent.node.style.position=t.parent.css.position),t.mode=-1}function initAll(){for(var t=watchArray.length-1;t>=0;t--)initElement(watchArray[t])}function deinitAll(){for(var t=watchArray.length-1;t>=0;t--)deinitElement(watchArray[t])}function switchElementMode(t,e){var i=t.node.style;switch(e){case 0:i.position="absolute",i.left=t.offset.left+"px",i.right=t.offset.right+"px",i.top=t.offset.top+"px",i.bottom="auto",i.width="auto",i.marginLeft=0,i.marginRight=0,i.marginTop=0;break;case 1:i.position="fixed",i.left=t.box.left+"px",i.right=t.box.right+"px",i.top=t.css.top,i.bottom="auto",i.width="auto",i.marginLeft=0,i.marginRight=0,i.marginTop=0;break;case 2:i.position="absolute",i.left=t.offset.left+"px",i.right=t.offset.right+"px",i.top="auto",i.bottom=0,i.width="auto",i.marginLeft=0,i.marginRight=0}t.mode=e}function clone(t){t.clone=document.createElement("div");var e=t.node.nextSibling||t.node,i=t.clone.style;i.height=t.height+"px",i.width=t.width+"px",i.marginTop=t.computed.marginTop,i.marginBottom=t.computed.marginBottom,i.marginLeft=t.computed.marginLeft,i.marginRight=t.computed.marginRight,i.padding=i.border=i.borderSpacing=0,i.fontSize="1em",i.position="static",i.cssFloat=t.computed.cssFloat,t.node.parentNode.insertBefore(t.clone,e)}function killClone(t){t.clone.parentNode.removeChild(t.clone),t.clone=void 0}function getElementParams(t){var e=getComputedStyle(t),i=t.parentNode,o=getComputedStyle(i),n=t.style.position;t.style.position="relative";var r={top:e.top,marginTop:e.marginTop,marginBottom:e.marginBottom,marginLeft:e.marginLeft,marginRight:e.marginRight,cssFloat:e.cssFloat,display:e.display},a={top:parseNumeric(e.top),marginBottom:parseNumeric(e.marginBottom),paddingLeft:parseNumeric(e.paddingLeft),paddingRight:parseNumeric(e.paddingRight),borderLeftWidth:parseNumeric(e.borderLeftWidth),borderRightWidth:parseNumeric(e.borderRightWidth)};t.style.position=n;var l={position:t.style.position,top:t.style.top,bottom:t.style.bottom,left:t.style.left,right:t.style.right,width:t.style.width,marginTop:t.style.marginTop,marginLeft:t.style.marginLeft,marginRight:t.style.marginRight},s=getElementOffset(t),c=getElementOffset(i),d={node:i,css:{position:i.style.position},computed:{position:o.position},numeric:{borderLeftWidth:parseNumeric(o.borderLeftWidth),borderRightWidth:parseNumeric(o.borderRightWidth),borderTopWidth:parseNumeric(o.borderTopWidth),borderBottomWidth:parseNumeric(o.borderBottomWidth)}},p={node:t,box:{left:s.win.left,right:html.clientWidth-s.win.right},offset:{top:s.win.top-c.win.top-d.numeric.borderTopWidth,left:s.win.left-c.win.left-d.numeric.borderLeftWidth,right:-s.win.right+c.win.right-d.numeric.borderRightWidth},css:l,isCell:"table-cell"==e.display,computed:r,numeric:a,width:s.win.right-s.win.left,height:s.win.bottom-s.win.top,mode:-1,inited:!1,parent:d,limit:{start:s.doc.top-a.top,end:c.doc.top+i.offsetHeight-d.numeric.borderBottomWidth-t.offsetHeight-a.top-a.marginBottom}};return p}function getDocOffsetTop(t){for(var e=0;t;)e+=t.offsetTop,t=t.offsetParent;return e}function getElementOffset(t){var e=t.getBoundingClientRect();return{doc:{top:e.top+win.pageYOffset,left:e.left+win.pageXOffset},win:e}}function startFastCheckTimer(){checkTimer=setInterval(function(){!fastCheck()&&rebuild()},500)}function stopFastCheckTimer(){clearInterval(checkTimer)}function handlePageVisibilityChange(){initialized&&(document[hiddenPropertyName]?stopFastCheckTimer():startFastCheckTimer())}function init(){initialized||(updateScrollPos(),initAll(),win.addEventListener("scroll",onScroll),win.addEventListener("wheel",onWheel),win.addEventListener("resize",rebuild),win.addEventListener("orientationchange",rebuild),doc.addEventListener(visibilityChangeEventName,handlePageVisibilityChange),startFastCheckTimer(),initialized=!0)}function rebuild(){if(initialized){deinitAll();for(var t=watchArray.length-1;t>=0;t--)watchArray[t]=getElementParams(watchArray[t].node);initAll()}}function pause(){win.removeEventListener("scroll",onScroll),win.removeEventListener("wheel",onWheel),win.removeEventListener("resize",rebuild),win.removeEventListener("orientationchange",rebuild),doc.removeEventListener(visibilityChangeEventName,handlePageVisibilityChange),stopFastCheckTimer(),initialized=!1}function stop(){pause(),deinitAll()}function kill(){for(stop();watchArray.length;)watchArray.pop()}function add(t){for(var e=watchArray.length-1;e>=0;e--)if(watchArray[e].node===t)return;var i=getElementParams(t);watchArray.push(i),initialized?initElement(i):init()}function remove(t){for(var e=watchArray.length-1;e>=0;e--)watchArray[e].node===t&&(deinitElement(watchArray[e]),watchArray.splice(e,1))}var doc=document,win=window,watchArray=[],scroll,initialized=!1,html=doc.documentElement,noop=function(){},checkTimer,hiddenPropertyName="hidden",visibilityChangeEventName="visibilitychange";void 0!==doc.webkitHidden&&(hiddenPropertyName="webkitHidden",visibilityChangeEventName="webkitvisibilitychange"),win.getComputedStyle||seppuku();for(var prefixes=["","-webkit-","-moz-","-ms-"],block=document.createElement("div"),i=prefixes.length-1;i>=0;i--){try{block.style.position=prefixes[i]+"sticky"}catch(e){}""!=block.style.position&&seppuku()}updateScrollPos();var Stickyfill={stickies:watchArray,add:add,remove:remove,init:init,rebuild:rebuild,pause:pause,stop:stop,kill:kill};module.exports=Stickyfill;
